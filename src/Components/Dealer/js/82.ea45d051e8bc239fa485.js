webpackJsonp([82,77],{"02iu":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("gyMJ"),r={data:function(){return{dialogVisible:!1,formData:{customerids:"",content:""},send2subs:!1,btnloading:!1}},components:{userTreeCheckbox:s("kIuH").default,messageComp:function(){return s.e(5).then(s.bind(null,"Xu8Z")).catch()}},computed:{permission:function(){return this.$store.state.functions}},methods:{setVisible:function(e){this.dialogVisible=e},setData:function(e){if(e){this.formData.customerids=e.id;var t=this;setTimeout(function(){t.$refs.userTree.setData(e)},0)}},checkedFn:function(e){this.formData.customerids=e.join(",")},onSubmit:function(){var e=this,t=this.checkParams();t&&(this.btnloading=!0,(this.send2subs?i._127:i._126)(t).then(function(t){e.$message.success(lg.success),e.cancelFn(),e.btnloading=!1}).catch(function(t){e.btnloading=!1}),this.countEvent({action:"发送消息",opt_label:"点击",val:"Dealer2"}))},checkParams:function(){return this.formData.customerids?this.$trim(this.formData.content)?this.formData.content.length>300?(this.$message.error(lg.sendMessageLen300),!1):{customerids:this.formData.customerids,content:this.formData.content}:(this.$message.error(lg.sendMessageNull),!1):(this.$message.error(lg.selectCustomer),!1)},showMessage:function(e){this.$refs.messageComp.setVisible(!0),this.$refs.messageComp.setActiveTab(e),this.$refs.messageComp.getunreadNum()},resetFm:function(){this.$refs.formData.resetFields(),this.$refs.userTree.clearFn()},cancelFn:function(){this.setVisible(!1),this.resetFm()},dialogCloseFn:function(){this.send2subs=!1,this.resetFm()}}},n={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"},{name:"mouseClose",rawName:"v-mouseClose"}],staticClass:"send-message-dialog",attrs:{title:e.lg.sendMessage,visible:e.dialogVisible,modal:!0,"show-close":!0,width:"600px","append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t},closed:e.dialogCloseFn}},[s("el-form",{ref:"formData",attrs:{model:e.formData,"show-message":!1,"label-width":"80px"},nativeOn:{submit:function(t){return t.preventDefault(),e.onSubmit.apply(null,arguments)}}},[s("el-form-item",{attrs:{label:e.lg.sendTo,required:"",prop:"customerids"}},[s("userTreeCheckbox",{ref:"userTree",on:{checked:e.checkedFn}}),e._v(" "),e.permission&&e.permission.sendmsg2allchildren?s("div",{staticClass:"send-child-box"},[s("el-checkbox",{model:{value:e.send2subs,callback:function(t){e.send2subs=t},expression:"send2subs"}},[e._v("\n          "+e._s(e.lg.send2subs)),s("i",{staticClass:"el-icon"})]),e._v(" "),s("el-tooltip",{staticClass:"item",attrs:{content:e.lg.send2subsTips,"popper-class":"el-txt-tips",effect:"dark",placement:"top"}},[s("i",{staticClass:"el-icon-info"})])],1):e._e()],1),e._v(" "),s("el-form-item",{attrs:{label:e.lg.content,required:"",prop:"content"}},[s("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":""},model:{value:e.formData.content,callback:function(t){e.$set(e.formData,"content",t)},expression:"formData.content"}})],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary","native-type":"submit",loading:e.btnloading}},[e._v(e._s(e.lg.submit))]),e._v(" "),s("el-button",{on:{click:e.cancelFn}},[e._v(e._s(e.lg.cancel))])],1),e._v(" "),s("el-form-item",[e._v("\n      "+e._s(e.lg.message)+":\n      "),s("a",{attrs:{href:"javascript://"},on:{click:function(t){return e.showMessage("system")}}},[e._v(e._s(e.lg.received))]),e._v(" /\n      "),s("a",{attrs:{href:"javascript://"},on:{click:function(t){return e.showMessage("sent")}}},[e._v(e._s(e.lg.sent))])])],1),e._v(" "),s("messageComp",{ref:"messageComp",attrs:{showUnreadMsg:!0}})],1)},staticRenderFns:[]};var o=s("VU/8")(r,n,!1,function(e){s("rFKK")},null,null);t.default=o.exports},"9bBU":function(e,t,s){s("mClu");var i=s("FeBl").Object;e.exports=function(e,t,s){return i.defineProperty(e,t,s)}},C4MV:function(e,t,s){e.exports={default:s("9bBU"),__esModule:!0}},UdMx:function(e,t){},bOdI:function(e,t,s){"use strict";t.__esModule=!0;var i,r=s("C4MV"),n=(i=r)&&i.__esModule?i:{default:i};t.default=function(e,t,s){return t in e?(0,n.default)(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}},kIuH:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("gyMJ"),r={data:function(){return{selectObj:[],selectKeys:[],filterText:"",showTree:!1,hideFlag:!0}},components:{tree:s("zAgK").default},computed:{loginId:function(){return this.$store.state.customerInfo.id}},methods:{setData:function(e){e._name=e.name,this.selectObj=[e],this.selectKeys=[e.id],this.setTreeKeys()},toggleTree:function(){if(this.showTree=!this.showTree,this.showTree){var e=this;setTimeout(function(){e.$refs.searchInput.focus()},100)}},blurFn:function(e){var t=this;setTimeout(function(){t.hideFlag&&(document.getElementsByClassName("user-tree-popper")[0].style.display="none",t.showTree=!1)},150)},closeTag:function(e){this.selectObj.splice(this.selectObj.findIndex(function(t){return t.id===e.id}),1),this.selectKeys=this.delArray(this.selectKeys,e.id),this.setTreeKeys()},expanded:function(){this.$refs.searchInput.focus(),this.hideFlag=!1;var e=this;setTimeout(function(){e.hideFlag=!0},300)},collapse:function(){this.$refs.searchInput.focus(),this.hideFlag=!1;var e=this;setTimeout(function(){e.hideFlag=!0},300)},handleCheckChange:function(e){this.selectObj=e.obj,this.selectKeys=e.key,this.$emit("checked",this.selectKeys),this.$refs.searchInput.focus(),this.hideFlag=!1;var t=this;setTimeout(function(){t.hideFlag=!0},300)},querySearchAsync:function(e,t){var s=this.$trim(e);if(""==s)return t([]);Object(i.T)({query:s,num:this.num,rootid:this.loginId}).then(function(e){for(var s=e.record,i=[],r=0,n=s.length;r<n;r++)i.push({index:s[r].index,value:s[r].value,value2:s[r].value+(s[r].account?"("+s[r].account+")":""),name:s[r].value,account:s[r].account,customerid:s[r].id,roletype:s[r].roletype,customers:s[r].index});t(i)}).catch(function(e){})},setTreeScrollPos:function(){setTimeout(function(){var e=document.querySelector(".tree-box"),t=document.querySelector(".el-tree-node.is-current.is-focusable.is-checked").offsetTop,s=e.offsetHeight,i=e.scrollTop;(t<i||t>i+s)&&(e.scrollTop=t-30)},300)},handleSelect:function(e){this.$refs.treeComp.selectTreeNode({customers:e.index},!0),this.setTreeScrollPos()},setTreeKeys:function(){var e=this;this.findObj("treeComp",this.$refs,function(){e.$refs.treeComp.setCheckedKeys(e.selectKeys)})},clearFn:function(){this.selectObj=[],this.selectKeys=[],this.setTreeKeys(),this.filterText="",this.showTree=!1,this.hideFlag=!0}}},n={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"user-tree-checkbox"},[s("div",{staticClass:"user-cur-box el-input__inner",on:{click:e.toggleTree}},[e._l(e.selectObj,function(t){return[s("el-tag",{staticClass:"ml5 tagClass",attrs:{closable:"",type:"info",effect:"dark",size:"small"},on:{close:function(s){return e.closeTag(t)}}},[e._v(e._s(t._name))])]}),e._v(" "),s("i",{staticClass:"icon-select",class:e.showTree?"el-icon-arrow-up":"el-icon-arrow-down"})],2),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.showTree,expression:"showTree"}],staticClass:"select-box"},[s("div",[s("el-autocomplete",{ref:"searchInput",staticStyle:{width:"100%"},attrs:{"trigger-on-focus":!1,"fetch-suggestions":e.querySearchAsync,placeholder:e.lg.account+"/"+e.lg.name,"popper-class":"user-tree-popper user-autocomplete"},on:{select:e.handleSelect,blur:function(t){return e.blurFn(t)}},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.item;return[s("i",{staticClass:"user-icon",class:"user-icon-"+i.roletype}),e._v(" "),s("div",{staticClass:"info"},[s("div",{staticClass:"s-name"},[e._v(e._s(i.name))]),e._v(" "),s("span",{staticClass:"s-account"},[e._v(e._s(i.account))])])]}}]),model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),e._v(" "),s("div",{staticClass:"tree-box"},[s("tree",{ref:"treeComp",attrs:{showCheckbox:!0},on:{expanded:e.expanded,collapse:e.collapse,checkChange:e.handleCheckChange}})],1)])])},staticRenderFns:[]};var o=s("VU/8")(r,n,!1,function(e){s("mRMY")},null,null);t.default=o.exports},mClu:function(e,t,s){var i=s("kM2E");i(i.S+i.F*!s("+E39"),"Object",{defineProperty:s("evD5").f})},mRMY:function(e,t){},rFKK:function(e,t){},zAgK:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("bOdI"),r=s.n(i),n=s("gyMJ"),o=s("KvKp"),a={props:["treeType","showCheckbox","rightClickFlag"],data:function(){return{treetype:"1",orderKey:"name",orderType:"asc",firstNode:null,firstResolve:null,deviceid:"",rightDisplay:!1,rightClickStatus:!1,hideRightTime:null,hoverRightTime:null,treeShow:!0,curUserId:"",optionleft:-1e4,optiontop:-1e4,defaultExpand:[],clickNum:0,dbClickTimeObj:null,defaultProps:{label:"name",children:[],isLeaf:"leaf"},refreshFlag:!1,loading:!1}},computed:{loginId:function(){return this.$store.state.customerInfo.id},firstData:function(){return this.$store.state.tree.first},childData:function(){return this.$store.state.tree.child}},components:{treeRight:function(){return s.e(132).then(s.bind(null,"XeIX"))}},methods:{reloadTree:function(e){this.treetype!=e&&(this.refreshFlag=!0,this.treetype=e||"1",this.loadNode(this.firstNode,this.firstResolve))},reloadTreeParent:function(){if(this.orderKey=Object(o.c)("treeCustomerOrderBy")||"name",this.orderType=Object(o.c)("treeCustomerOrderType")||"asc",this.curUserId){this.refreshFlag=!0;var e=this.$refs.tree.getNode(this.curUserId);e.parent.loaded=!1,e.parent.expand()}},refresh:function(){if(this.curUserId){this.refreshFlag=!0;var e=this.$refs.tree.getNode(this.curUserId);this.getSelfData(e),e.loaded=!1,e.expand()}},refreshNode:function(e,t){this.refreshFlag=!0,this.getSelfData(t),t.loaded=!1,t.expand(),e.stopPropagation()},refreshSelf:function(){if(this.curUserId){var e=this.$refs.tree.getNode(this.curUserId);this.getSelfData(e)}},loadNode:function(e,t){0===e.level?(this.firstNode=e,this.firstResolve=t,this.firstNode.childNodes=[],this.getFirstData(t)):e.level>=1&&this.getChildData(e,t)},getSelfData:function(e){var t=this;Object(n._155)({customerid:e.data.id,treetype:this.treetype}).then(function(s){var i=s.record;e.data.name=("account"==t.orderKey?i.account:i.name)+"("+i.ownnum+"/"+i.totalnum+")",e.data.account=i.account,e.data.role=i.role,e.data.roletype=i.roletype,e.data.type=i.type,e.data.isread=i.isread,e.data._name=i._name}).catch(function(e){})},getFirstData:function(e){var t=this,s=1==this.treetype;this.firstData&&s?this.renderFirst(e,this.firstData):(this.loading=!0,this.$store.dispatch("getTreeFirst",{param:{customerid:this.loginId,treetype:this.treetype},save:s}).then(function(s){t.renderFirst(e,s.record),t.loading=!1,t.$emit("treeLoaded")}).catch(function(e){t.loading=!1}))},renderFirst:function(e,t){var s;e([(s={id:t.customerid,name:t.name+"("+t.ownnum+"/"+t.totalnum+")",_name:t.name,account:t.account,leaf:!t.hadchild,type:t.type,role:t.role,roletype:t.roletype},r()(s,"_name",t.name),r()(s,"isread",t.isread),s)]),t.hadchild&&!this.inArray(this.defaultExpand,t.customerid)&&this.defaultExpand.push(t.customerid);var i=this;setTimeout(function(){i.$refs.tree.setCurrentKey(t.customerid)},0)},getChildData:function(e,t){var s=this,i=1==e.level&&1==this.treetype;this.childData&&i&&!this.refreshFlag?this.renderChild(e,t,this.childData):this.$store.dispatch("getTreeChild",{param:{customerid:e.data.id,puretree:1,treetype:this.treetype},save:i}).then(function(i){if(s.refreshFlag=!1,!i.record)return t([]);s.renderChild(e,t,i.record)}).catch(function(e){s.refreshFlag=!1})},renderChild:function(e,t,s){for(var i=[],r=0,n=(s=this.treeSortor(s)).length;r<n;r++)i.push({id:s[r].id,name:("account"==this.orderKey?s[r].account:s[r].name)+"("+s[r].ownnum+"/"+s[r].totalnum+")",account:s[r].account,leaf:!s[r].hadchild,type:s[r].type,role:s[r].role,roletype:s[r].roletype,_name:s[r].name,isread:s[r].isread});t(i)},treeSortor:function(e){var t,s=this;switch(s.orderKey){case"name":case"account":return e.sort(function(e,i){return t=e[s.orderKey].localeCompare(i[s.orderKey]),"asc"==s.orderType?t:-t});case"id":case"ownnum":case"totalnum":return e.sort(function(e,i){return t=e[s.orderKey]-i[s.orderKey],"asc"==s.orderType?t:-t});default:return e}},renderContent:function(e,t){var s=this,i=t.node,r=t.data,n=(t.store,void 0),o="",a=r._name+"("+r.account+")";return"1"==r.role?n=e("div",{class:"custom-tree-node fl",directives:[{name:"tip",value:["<div style=\"padding-left:20px;background-image:url('/dealer/images/vip.png');background-repeat:no-repeat;background-position:-6px -2px;\">"+lg.superAdmin+"</div>","<div>"+a+"</div>"].join("\n")}]},[e("div",{class:"custom-tree-node-cont"},[e("i",{class:"tree-icon "+(r.leaf?"userIcon"+r.type:"userIconArr"+r.type)}),e("span",{class:"tree-node-word "+("1"==r.role?"red":"")},[r.name]),this.rightClickFlag?e("span",{class:"el-icon-more-v",on:{click:function(e){return s.clickShowMore(e,r)}}}):e("span",{class:"tree-refresh el-icon-refresh",on:{click:function(e){return s.refreshNode(e,i)}}})])]):(o=r.leaf?"userIcon"+r.type:"userIconArr"+r.type,1==r.isread&&(1==r.type&&(o="dealerIconReadonly"),2==r.type&&(o="userIconReadonly")),n=e("div",{class:"custom-tree-node fl",directives:[{name:"tip",value:a}]},[e("div",{class:"custom-tree-node-cont"},[e("i",{class:"tree-icon "+o}),e("span",{class:"tree-node-word"},[r.name]),this.rightClickFlag?e("span",{class:"el-icon-more-v",on:{click:function(e){return s.clickShowMore(e,r)},mouseover:function(e){return s.hoverShowMore(e,r)},mouseout:function(e){return s.hoverHideMore(e,r)}}}):e("span",{class:"tree-refresh el-icon-refresh",on:{click:function(e){return s.refreshNode(e,i)}}})])])),n},clickShowMore:function(e,t){this.rightClickStatus=!0,this.showRightClick(e,t),e.stopPropagation()},hoverShowMore:function(e,t){if(clearTimeout(this.hideRightTime),!this.rightClickStatus){var s=this;this.hoverRightTime=setTimeout(function(){s.showRightClick(e,t)},300),e.stopPropagation()}},hoverHideMore:function(){clearTimeout(this.hoverRightTime);var e=this;this.hideRightTime=setTimeout(function(){e.hideRightOption()},500)},hideRightOption:function(){this.rightDisplay=!1,document.body.onclick=null,this.rightClickStatus=!1},rightOptionHover:function(){clearTimeout(this.hideRightTime)},rightOptionHoverOut:function(){var e=this;this.hideRightTime=setTimeout(function(){e.hideRightOption()},500)},rightClick:function(e,t){this.rightClickStatus=!0,this.showRightClick(e,t)},showRightClick:function(e,t){if(this.rightClickFlag){this.rightDisplay=!0;var s=this;setTimeout(function(){var i=s.$refs.treeRightComp.$el.offsetHeight,r=document.documentElement.clientHeight;s.optiontop=e.clientY+i>r?e.clientY-i:e.clientY,s.optionleft=e.clientX+15,s.$refs.treeRightComp.setData(t)},0),this.curUserId=t.id,document.body.onclick=function(){s.hideRightOption()}}},handleCheckChange:function(e,t,s){var i=this.$refs.tree.getCheckedNodes(),r=this.$refs.tree.getCheckedKeys();this.$emit("checkChange",{obj:i,key:r})},setCheckedKeys:function(e){this.$refs.tree.setCheckedKeys(e)},nodeClick:function(e,t,s){for(var i=t,r=[e.id];i&&i.parent&&i.parent.data;)r.push(i.parent.data.id),i=i.parent;this.$emit("treeNodeClick",e,r),this.curUserId=e.id,this.rightDisplay=!1,this.dbClick(window.event,e,t,s)},dbClick:function(e,t,s,i){if(e){this.clickNum++,2==this.clickNum&&(this.rightClickStatus=!0,this.showRightClick(e,t,s,i));var r=this;clearTimeout(this.dbClickTimeObj),this.dbClickTimeObj=setTimeout(function(){r.clickNum=0},500)}},selectTreeNode:function(e,t){var s="string"==typeof e.customers?e.customers.split(",").reverse().map(Number):e.customers,i=s.pop();this.defaultExpand=s;var r=this;!function e(){var s=r.$refs.tree.getNode(i);if(s&&!r.loading){if(r.$refs.tree.setCurrentKey(s.key),r.nodeClick(s.data,s),t){var n=r.$refs.tree.getCheckedKeys()||[];n.push(s.key),r.$refs.tree.setCheckedKeys(n)}}else setTimeout(function(){e()},200)}()},getCurrentNode:function(){return this.$refs.tree.getCurrentNode()},nodeExpandFn:function(e,t){this.defaultExpand.push(e.id),this.$emit("expanded")},nodeCollapseFn:function(e){this.defaultExpand.splice(this.defaultExpand.indexOf(e.id),1),this.$emit("collapse")}},mounted:function(){this.curUserId=this.loginId},created:function(){this.treetype=this.treeType?this.treeType:"1",this.orderKey=Object(o.c)("treeCustomerOrderBy")||"name",this.orderType=Object(o.c)("treeCustomerOrderType")||"asc"}},c={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"tree-comp"},[s("el-tree",{directives:[{name:"show",rawName:"v-show",value:e.treeShow,expression:"treeShow"}],ref:"tree",attrs:{lazy:"",load:e.loadNode,props:e.defaultProps,"node-key":"id","default-expanded-keys":e.defaultExpand,"empty-text":e.lg.noData,accordion:!0,"expand-on-click-node":!1,"highlight-current":!0,"show-checkbox":e.showCheckbox,"render-content":e.renderContent,"check-strictly":!0,"check-on-click-node":!0},on:{"node-click":e.nodeClick,"node-contextmenu":e.rightClick,"check-change":e.handleCheckChange,"node-expand":e.nodeExpandFn,"node-collapse":e.nodeCollapseFn}}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.rightDisplay,expression:"rightDisplay"}],staticClass:"tree-right-option",style:{left:e.optionleft+"px",top:e.optiontop+"px"}},[s("treeRight",{ref:"treeRightComp",on:{reloadTreeParent:e.reloadTreeParent,refresh:e.refresh,refreshSelf:e.refreshSelf,mouseEnterEv:e.rightOptionHover,mouseLeaveEv:e.rightOptionHoverOut}})],1)],1)},staticRenderFns:[]};var l=s("VU/8")(a,c,!1,function(e){s("UdMx")},null,null);t.default=l.exports}});